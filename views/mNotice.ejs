<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="/stylesheets/bootstrap.min.css">
    <script src="/javascript/jquery-3.5.1.min.js"></script>
    <script src="/javascript/popper.min.js"></script>
    <script src="/javascript//bootstrap.min.js"></script>
    <script src="/javascript/getDate.js"></script>
    <link rel="stylesheet" href="/stylesheets/style.css">
    <link rel="stylesheet" href="/stylesheets/fontello.css">
    <link rel="stylesheet" href="/stylesheets/sider.css">
    <link rel="stylesheet" href="/stylesheets/notice.css">
    <script src="/javascript/vue.js"></script>

    <title>Document</title>


    <style>
        /* 環境 */
    </style>

</head>

<body>

    <!-- 左邊sider -->
    <%- include('mSider', {active}); %>

    <div class="containerRight" id='mNotice'>
        <!-- 右邊內容放置區 -->

        <nav class="topTag row inWrapper position-sticky">
            <div :class="tab==0 ?'dTag text24RG act' : 'dTag text24RG'" @click='tab=0'>平台通知({{this.dNticeCount}})</div>
            <div :class="tab==1 ?'dTag text24RG act' : 'dTag text24RG'" @click='tab=1'>訂單狀況(1)</div>
            <div :class="tab==2 ?'dTag text24RG act' : 'dTag text24RG'" @click='tab=2'>投票、訂單通知(1)</div>
            <a class="more ml-auto" href="#" role="button" id="more" data-toggle="dropdown" aria-haspopup="true"
                aria-expanded="false">
            </a>
            <div class="dropdown-menu text-center tag-wrap" aria-labelledby="more" id='moreMenu'>
                <a class="dropdown-item text20R" href="#">全部已讀</a>
                <a class="dropdown-item text20R" href="#">全部刪除</a>

            </div>
        </nav>
        <div class="dblock mt-4">
            <ul class="scrollList noticeList">
                <!-- 系統通知 -->
                <span v-if='tab==0'>
                    <span v-for='(item,index) in dNticeData'>
                        <span v-if='item.noticeStatus > 0'>
                            <li :class="item.noticeStatus== 2 ? 'noticeItem d-flex align-items-center read':'noticeItem d-flex align-items-center'"
                                @click='readStatus(index)'>
                                <img src="/image/message.png">
                                <span class="content">
                                    <h2 class="text24B">訂訂系統緊急升級通知</h2>
                                    <p class="text20R">{{item.noticeContent}}</p>
                                    <p class="text16">{{item.noticeTime}}</p>
                                </span>
                                <span class="ml-auto actionR">
                                    <i class="icon-trash" @click='deleteDN(index)'></i>
                                </span>
                            </li>
                        </span>
                    </span>
                </span>

                <!-- 店家新訊息 -->
                <span v-if='tab==1'>
                    <li class="noticeItem d-flex align-items-center">
                        <!-- <span class="photo"></span> -->
                        <img src="/image/store/Taichung/八方雲集_台中向上店/index.jpeg">
                        <span class="content">
                            <h2 class="text24B">貓咪腹肌　已接受訂單</h2>
                            <p class="text20R">貓咪腹肌已接受訂單，當餐點送達後，請點擊完成訂單按鈕</p>
                            <p class="text16">剛剛</p>
                        </span>
                        <span class="ml-auto actionR d-flex align-items-center">
                            <span class="eng20R price">
                                <span class=" align-middle">4,000</span>
                            </span>
                            <button class="text20R dbtn btnW d-none">建立新訂單</button>
                            <button class="text20R dbtn btnB d-none">移動至訂單</button>
                            <button class="text20R dbtn btnY" data-toggle="modal" data-target="#comfirm2Btn">
                                完成訂單</button>
                            <i class="icon-trash d-none"></i>
                            <p class="text20R d-none">等待中..</p>
                        </span>
                    </li>

                    <!-- 已讀 -->
                    <li class="noticeItem d-flex align-items-center read">
                        <!-- <span class="photo"></span> -->
                        <img src="/image/message.png">
                        <span class="content">
                            <h2 class="text24B">八方雲集　已完成訂單</h2>
                            <p class="text20R">您已經完成訂單了，期待您的下次訂購。</p>
                            <p class="text16">3小時前</p>
                        </span>
                        <span class="ml-auto actionR d-flex align-items-center">
                            <span class="eng20R price ">
                                <span class=" align-middle">4,000</span>
                            </span>

                            <button class="text20R dbtn btnW d-none">建立新訂單</button>
                            <button class="text20R dbtn btnB d-none">移動至訂單</button>
                            <button class="text20R dbtn btnY d-none" data-toggle="modal" data-target="#comfirm2Btn">
                                完成訂單</button>
                            <i class="icon-trash"></i>
                            <p class="text20R d-none">等待中..</p>
                        </span>
                    </li>

                    <!-- 已讀取消訂單 -->
                    <span v-for='(item,index) in OderNoticeData'>
                        <li :class="item.noticeStatus==2 ?
                        'noticeItem d-flex align-items-center read cancel store':'noticeItem d-flex align-items-center cancel store'">
                        <img src="/image/message.png">
                        <span class="content">
                            <h2 class="text24B"><span>{{item.storeName}}</span> 已取消訂單</h2>
                            <p class="text20R">店家因太忙或種種原因，而取消了訂單，我們將會退還全額給您。</p>
                            <p class="text16">{{item.noticeTime}}</p>
                        </span>

                        <span class="ml-auto actionR d-flex align-items-center">
                            <span class="eng20R price d-none">
                                <span class=" align-middle">4,000</span>
                            </span>

                            <button class="text20R dbtn btnW d-none">建立新訂單</button>
                            <a href="mOrder"><button class="text20R dbtn btnB">移動至訂單</button></a>
                            <i class="icon-trash"></i>
                        </span>
                    </li>
                    </span>
                </span>
                <!-- 已讀取消訂單 -->
                <span v-if='tab==2'>
                    <li class="noticeItem d-flex align-items-center read">
                        <span class="photo"></span>
                        <!-- <img src="/image/message.png"> -->
                        <span class="content">
                            <h2 class="text24B">被程式耽誤的通靈王</h2>
                            <p class="text20R">此團體已新增排程囉~</p>
                            <p class="text16">6小時前</p>
                        </span>

                        <span class="ml-auto actionR d-flex align-items-center">
                            <span class="eng20R price d-none">
                                <span class=" align-middle">4,000</span>
                            </span>

                            <button class="text20R dbtn btnW d-none">建立新訂單</button>
                            <button class="text20R dbtn btnB">移動至排程</button>
                            <button class="text20R dbtn btnY d-none" data-toggle="modal" data-target="#comfirm2Btn">
                                完成訂單</button>
                            <i class="icon-trash"></i>
                            <p class="text20R d-none">等待中..</p>
                        </span>

                    </li>
                </span>

            </ul>
        </div>
    </div>

    <!-- 完成訂單) -->
    <div class="modal fade sm2Btn" id="comfirm2Btn">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title text28B">完成訂單</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <i class=" icon-close"></i>
                    </button>
                </div>
                <p class="modal-body text24R">
                    請確認餐點無誤，我們將撥款給店家
                </p>
                <div class="modal-footer">
                    <button class="text20R dbtn btnW" data-dismiss="modal">取消返回</button>
                    <button class="text20R dbtn btnY ml-3">完成訂單</button>
                </div>
            </div>
        </div>
    </div>
    <script>

        // vue資料
        let mNotice = new Vue({
            el: '#mNotice',
            data: {
                memberData: JSON.parse('<%- mMemberData %>'),
                dNticeData: JSON.parse('<%- dNticeData %>'),
                OderNoticeData: JSON.parse('<%- OderNoticeData %>'),
                tab: 0
            },
            mounted: function () {
                this.dNticeData.forEach(function (item) {
                    item.noticeTime = getDate(item.noticeTime);
                })



            },
            methods: {
                // 已讀
                readStatus(index) {
                    if (this.dNticeData[index].noticeStatus == 1) {
                        this.dNticeData[index].noticeStatus = 2
                    }
                },
                // readCancelStatus(index) {
                //     if (this.orderCaNoticeData[index].noticeStatus == 1) {
                //         this.orderCaNoticeData[index].noticeStatus = 2;
                //     }
                // },
                // readOkStatus(index) {
                //     if (this.orderOkNoticeData[index].noticeStatus == 1) {
                //     this.orderOkNoticeData[index].noticeStatus = 2;
                //     }
                // },
                // readNewStatus(index) {
                //     this.orderNoticeData[index].noticeStatus = 2;
                // },

                // 刪除
                deleteDN(index) {
                    this.dNticeData[index].noticeStatus = 0;
                },
                // deleteCaN(index) {
                //     this.orderCaNoticeData[index].noticeStatus = 0;
                // },
                // deleteOkN(index) {
                //     this.orderOkNoticeData[index].noticeStatus = 0;
                // }

            }, computed: {
                // 平台通知數量
                dNticeCount: function () {
                    let a = 0;
                    this.dNticeData.forEach(function (item) {
                        if (item.noticeStatus == 1) {
                            a += 1;
                        }
                    });
                    return a;
                }
            }
        })
    </script>
</body>


</html>